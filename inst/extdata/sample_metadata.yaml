SPX:
  longname: "S&P 500 daily close"
  description: |
    Quandl, fill missing values with Yahoo.
    Backfill weekends and holidays.
    Cache for an hour.
    Warn if newest value older than a day.
  type: timeseries
  children:
    Cache:
      type: instruction
      fun: memoise
      arguments:
        f: '@children/fun'
        timeout: 3600
      children:
        Close:
          type: instruction
          fun: magrittr::use_series
          arguments:
            xts: '@children'
            series: Close
          children:
            Fill NAs:
              type: instruction
              fun: na.locf
              arguments:
                xts: '@children'
              children:
                NA Ratio:
                  type: warning
                  fun: NaRatio
                  arguments:
                    timeseries: '@children'
                  children:
                    Regularize:
                      type: instruction
                      fun: Regularize
                      arguments:
                        xts: '@children'
                      children:
                        Combine:
                          type: instruction
                          fun: Combine
                          arguments:
                            ...: '@children'
                          children:
                            MinLength Q:
                              type: error
                              fun: MinLength
                              arguments:
                                timeseries: '@children'
                                minLength: 10
                              children:
                                Quandl:
                                  type: instruction
                                  fun: Quandl::Quandl
                                  arguments:
                                    ticker: "YAHOO/INDEX_GSPC"
                                    type: xts
                            MinLength Y:
                              type: warning
                              fun: MinLength
                              arguments:
                                timeseries: '@children'
                                minLength: 10
                              children:
                                Yahoo:
                                  type: instruction
                                  fun: quantmod::getSymbols
                                  arguments:
                                    Symbols: "^GSPC"
                                    auto.assign: FALSE



