SPX:
  longname: "S&P 500 daily close"
  description: |
    Quandl, fill missing values with Yahoo.
    Backfill weekends and holidays.
    Cache for an hour.
    Warn if newest value older than a day.
  type: timeseries
  children:
    Cache:
      type: transformation
      fun: memoise
      arguments:
        f: '@children/fun'
        timeout: 3600
      children:
        Close:
          type: transformation
          fun: magrittr::use_series
          arguments:
            xts: '@children'
            series: Close
          children:
            NA Handling:
              type: moduleref
              name: NAs
              children:
                Regularize:
                  type: transformation
                  fun: Regularize
                  arguments:
                    xts: '@children'
                  children:
                    Combine:
                      type: transformation
                      fun: Combine
                      arguments:
                        ...: '@children'
                      children:
                        MinLength Q:
                          type: error
                          fun: MinLength
                          arguments:
                            timeseries: '@children'
                            minLength: 10
                          children:
                            Quandl:
                              type: transformation
                              fun: Quandl::Quandl
                              arguments:
                                ticker: "YAHOO/INDEX_GSPC"
                                type: xts
                        MinLength Y:
                          type: warning
                          fun: MinLength
                          arguments:
                            timeseries: '@children'
                            minLength: 10
                          children:
                            Yahoo:
                              type: transformation
                              fun: quantmod::getSymbols
                              arguments:
                                Symbols: "^GSPC"
                                auto.assign: FALSE


NA Handling:
  type: module
  children:
    Fill NAs:
      type: transformation
      fun: na.locf
      arguments:
        xts: '@children'
      children:
        NA Ratio:
          type: warning
          fun: NaRatio
          arguments:
            timeseries: '@children'
