SPX:
  longname: "S&P 500 daily close"
  description: |
    Quandl, fill missing values with Yahoo.
    Backfill weekends and holidays.
    Cache for an hour.
    Warn if newest value older than a day.
  type: timeseries
  children:
    Cache:
      type: function
      fun: Cache
      arguments:
        f: '@children'
        timeout: 3600
      children:
        Close:
          type: transformation
          fun: magrittr::use_series
          arguments:
            xts: '@children'
            series: Close
          children:
            Fill NAs:
              type: transformation
              fun: na.locf
              arguments:
                object: '@children'
              children:
                NA Ratio:
                  type: warning
                  fun: NaRatio
                  arguments:
                    timeseries: '@children'
                    variable: Close
                    maxRatio: 0.25
                  children:
                    Regularize:
                      type: transformation
                      fun: Regularize
                      arguments:
                        xts: '@children'
                      children:
                        Combine:
                          type: transformation
                          fun: Combine
                          arguments:
                            listofxts: '@children'
                          children:
                            MinLength Q:
                              type: error
                              fun: MinLength
                              arguments:
                                timeseries: '@children'
                                minLength: 10
                              children:
                                Quandl:
                                  type: transformation
                                  fun: Quandl::Quandl
                                  arguments:
                                    code: "YAHOO/INDEX_GSPC"
                                    type: xts
                            MinLength Y:
                              type: warning
                              fun: MinLength
                              arguments:
                                timeseries: '@children'
                                minLength: 10
                              children:
                                SetNames:
                                  type: transformation
                                  fun: SetNames
                                  arguments:
                                    x: '@children'
                                    names: [Open, High, Low, Close, Volume, 'Adjusted Close']
                                  children:
                                    Yahoo:
                                      type: transformation
                                      fun: quantmod::getSymbols
                                      arguments:
                                        Symbols: "^GSPC"
                                        auto.assign: FALSE



